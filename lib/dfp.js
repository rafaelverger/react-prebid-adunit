"use strict";function _typeof(a){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _prebid=_interopRequireDefault(require("./_prebid")),_propTypes=_interopRequireDefault(require("prop-types"));function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}function ownKeys(a,b){var c=Object.keys(a);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(a);b&&(d=d.filter(function(b){return Object.getOwnPropertyDescriptor(a,b).enumerable})),c.push.apply(c,d)}return c}function _objectSpread(a){for(var b,c=1;c<arguments.length;c++)b=null==arguments[c]?{}:arguments[c],c%2?ownKeys(Object(b),!0).forEach(function(c){_defineProperty(a,c,b[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(b)):ownKeys(Object(b)).forEach(function(c){Object.defineProperty(a,c,Object.getOwnPropertyDescriptor(b,c))});return a}function _defineProperty(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),b&&_setPrototypeOf(a,b)}function _setPrototypeOf(a,b){return _setPrototypeOf=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a},_setPrototypeOf(a,b)}function _createSuper(a){var b=_isNativeReflectConstruct();return function(){var c,d=_getPrototypeOf(a);if(b){var e=_getPrototypeOf(this).constructor;c=Reflect.construct(d,arguments,e)}else c=d.apply(this,arguments);return _possibleConstructorReturn(this,c)}}function _possibleConstructorReturn(a,b){return b&&("object"===_typeof(b)||"function"==typeof b)?b:_assertThisInitialized(a)}function _assertThisInitialized(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(a){return!1}}function _getPrototypeOf(a){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(a){return a.__proto__||Object.getPrototypeOf(a)},_getPrototypeOf(a)}var propTypes={slot:_propTypes.default.string.isRequired,adNetwork:_propTypes.default.string.isRequired,targeting:_propTypes.default.object,afterAdLoaded:_propTypes.default.func,flexible:_propTypes.default.bool},defaultProps={targeting:{},afterAdLoaded:function afterAdLoaded(){}},DFPPrebidContainer=/*#__PURE__*/function(a){function b(a){var d,e;return _classCallCheck(this,b),e=c.call(this,a),e.slotRendered=(d=e).slotRendered.bind(d),e}_inherits(b,a);var c=_createSuper(b);return _createClass(b,[{key:"adServerInit",value:function adServerInit(){window.googletag||(window.googletag={cmd:[function(){return window.googletag.pubads().disableInitialLoad()}]})}},{key:"adServerType",value:function adServerType(){return"dfp"}},{key:"adServerURL",value:function adServerURL(){return"https://www.googletagservices.com/tag/js/gpt.js"}},{key:"adServerRequest",value:function adServerRequest(){var a=this,b=window,c=b.googletag;c.cmd.push(function(){a.afterAdServerRequest().then(function(){c.pubads().refresh()})})}},{key:"adServerSlot",value:function adServerSlot(a,b){var c=this,d=window,e=d.googletag,f=this.props,g=f.adNetwork,h=f.slot,i=f.dimensions,j=f.targeting,k=f.domID,l="/".concat(g,"/").concat(h);e.cmd.push(function(){/*
       * Here the ad slot will be requested and then the response will be
       * analysed by `this.slotRendered`.
       *
       * Full GPT (google publisher tag) doc:
       *   https://developers.google.com/doubleclick-gpt/reference
       */var d=e.pubads(),f=e.defineSlot(l,i,k);// googletag.pubads
Object.keys(j).forEach(function(a){return f.setTargeting(a,j[a])}),f.addService(d),d.addEventListener("slotRenderEnded",c.slotRendered),a&&(d.enableSingleRequest(),e.enableServices(),b())})}},{key:"slotRendered",value:function slotRendered(a){var b=this.props,c=b.flexible,d=b.domID,e=document.getElementById(d).querySelector("iframe"),f=a.size||[];if(a.slot.getSlotId().getDomId()===d&&("1x1"===f.join("x")&&(f=[e.width,e.height]),this.props.afterAdLoaded(!a.isEmpty,f),c&&!a.isEmpty)){var g=e.parentNode,h=e.contentDocument;g.style.width="100%",g.style.height="auto",e.width="100%";var i=function(){e.height=h.body.offsetHeight},j=[].slice.call(h.querySelectorAll("img"),0);j.forEach(function(a){return a.addEventListener("load",i)}),i()}}}],[{key:"propTypes",get:function get(){return _objectSpread(_objectSpread({},_prebid.default.propTypes),propTypes)}},{key:"defaultProps",get:function get(){return _objectSpread(_objectSpread({},_prebid.default.defaultProps),defaultProps)}}]),b}(_prebid.default);exports.default=DFPPrebidContainer;